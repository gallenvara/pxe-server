#Generated by Kickstart Configurator
#platform=x86, AMD64, or Intel EM64T
#Install OS instead of upgrade
install

#Use NFS instllation media
ftpserver

#System  language
lang en_US.UTF-8

#System keyboard
keyboard us

#Sytem timezone
timezone Asia/Shanghai

#Root password
rootpw 123456

#Reboot after installation
reboot

#System bootloader configuration
bootloader --location=mbr 

#Clear the Master Boot Record
zerombr

#Use text mode installation
text

#Partition clearing information
clearpart --all --initlabel

# Disk partitioning information 
part / --fstype="ext4" --size=81920 
part swap --fstype="swap" --size=10240 
part /home --fstype="ext4" --size=143360

#System authorization infomation
authconfig --enableshadow --passalgo=sha512

#Network information
network --bootproto=dhcp --device=eth0

#Firewall configuration
firewall --disabled 

#SELinux configuration
selinux --disabled

#Reboot after installation
reboot

#XWindows configuration information
xconfig  --startxonboot

#Package install information
%packages
@additional-devel
@base
@compat-libraries
@console-internet
@core
@debugging
@desktop-debugging
@dial-up
@development
@directory-client
@ftp-server
@fonts
@gnome-desktop
@guest-agents
@guest-desktop-agents
@graphical-admin-tools
@hardware-monitoring
@input-methods
@internet-browser
@java-platform
@large-systems
@legacy-x
@multimedia
@network-server
@network-file-system-client
@networkmanager-submodules
@network-tools
@performance
@perl-runtime
@system-admin-tools
@web-server
@php
@x11
libXinerama-devel
xorg-x11-proto-devel
startup-notification-devel
libgnomeui-devel
libbonobo-devel
libXau-devel
libgcrypt-devel
popt-devel
libXrandr-devel
libxslt-devel
libglade2-devel
gnutls-devel
mtools
maven
pax
java-1.7.0
python-dmidecode
oddjob
sgpio
genisoimage
wodim
oprofile-gui
abrt-gui
ant
emacs
expect
jpackage-utils
certmonger
pam_krb5
krb5-workstation
vim-X11
libXmu
dnsmasq
dhcp
tftp-server
iptraf
sdparm
perl-DBD-SQLite
crypto-utils
certmonger
perl-CGI
-gcc-gfortran
%end

%pre  --log=/tmp/kspre.log

exec < /dev/tty3 > /dev/tty3 2>&1
chvt 3
install="no"
while [ "$install" != "yes" ]; do
   clear
   echo
   echo '********************************************************************************'
   echo '*                                 W A R N I N G                                *'
   echo '*                                                                              *'
   echo '*  You are about to start the installation of CentOS 7.                        *'
   echo '*  This process will install a completely new operating system and software.   *'
   echo '*  Any software previously on this system will be irrevocably lost.            *'
   echo '*                                                                              *'
   echo '********************************************************************************'
   echo
   read -p "Proceed with install (yes or no)? " install
   if [ $install == "no" ] ; then
     reboot
   fi
done

clear

mkdir -p /tmp/intel
cp -a /mnt/stage2/intel/osinstall /tmp/intel
chmod +x /tmp/intel/*.sh

clear
chvt 1

%end

%post --nochroot --log=/mnt/sysimage/root/ks-post.log
#copy all needed files to target system
mkdir -p /mnt/sysimage/tmp
cp -a /tmp/intel /mnt/sysimage/tmp

exec < /dev/tty3 > /dev/tty3 2>&1
chvt 3
clear
chroot /mnt/sysimage /bin/sh /tmp/intel/postwork.sh 

chvt 1

%end
